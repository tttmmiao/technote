
[TOC] 


## 线程池 ThreadPoolExecutor
* corePoolSize
* maximumPoolSize
* keepAliveTime
* unit
* workQueue 线程池所使用的缓冲队列
* handler 线程池对拒绝任务的处理策略

----------------------------------------
线程池数量：

* < corePoolSize，即使线程池中的线程都处于空闲状态，也会创建新的线程来处理被添加的任务。
* = corePoolSize && workQueue未满，任务被放入缓冲队列。
* > corePoolSize && workQueue满 && < maximumPoolSize，建新的线程来处理被添加的任务
* > corePoolSize && workQueue满 && = maximumPoolSize，通过handler所指定的策略处理任务

--------------------------------------
线程被处理的优先级：corePoolSize, workQueue, maximumPoolSize

---------------------------------
线程池任务拒绝策略：
抛出异常；
不用线程池线程执行；
直接丢弃任务（不抛异常）；
丢弃队列中最旧的任务

## JVM安全退出
上线，重启应用，异步任务丢了
jvm安全关闭来保证一步操作进行完成后，jvm再执行关闭。
Linux上经常采用kill - 9 pid强制杀掉进程
* JVM关闭时扫尾工作，提供了关闭钩子（shutdown hooks）
 ![JVM关闭情境](http://img10.360buyimg.com/n7/s523x355_jfs/t6595/305/70607884/742714/c76b7170/59390c8aNf12b52ac.bmp)
 ![jvm与shutdown hooks交互流程](http://img10.360buyimg.com/n7/s1306x1261_jfs/t6205/257/91070679/64131/65b88829/5939100fNaf1f9cbe.png)
 
## 分布式事务
### 本地消息表
* 通知方式：
 * mq 存在问题：消息丢失
 * 定时轮询  存在问题：大部分时间在做无用功
* 消息消费 - 如何避免重复消费
 * 消费状态表
 
* 如何保证消息和业务操作一只
  * 持久化消息，通过状态采取重试机制

* 如何避免消息被重复消费造成的问题
	* 消费者调用业务的服务接口保证幂等性
	* 消费日志或状态表

[保证分布式系统数据一致性的6种方案](https://weibo.com/ttarticle/p/show?id=2309403965965003062676)
[保持数据一致性的设计方案](http://yangbolin.cn/2017/06/25/two-consistency-design-tech/)


## java GC
[java-gc日志](http://blog.csdn.net/wanglha/article/details/48713217)
[GC-分析](http://www.ityouknow.com/jvm/2017/09/18/GC-Analysis.html)
[jvm调优-命令篇](http://www.ityouknow.com/jvm/2017/09/03/jvm-command.html)


## 数据库
(数据库死锁)[http://www.ywnds.com/?p=4949]
(数据库MVCC)[https://draveness.me/database-concurrency-control]
(mvcc)[https://www.enterprisedb.com/node/3412]
(understanding explain output)[https://www.sitepoint.com/using-explain-to-write-better-mysql-queries/]
(mysql - explain 案例文章)[http://s.petrunia.net/blog/index.php?paged=2]
(为什么要拒绝使用)[http://www.importnew.com/27617.html]

Q1： mvcc和乐观锁的区别是什么？

Q2: 脏读，不可重复读，幻读的区别是？
Q3: myisam(my-z[ei]m)和innodb的特点？适合使用的场景？
Q4: S锁，X锁，IS锁，IX锁，gap锁, next-key lock？
Q5: mvcc只在rc和rr级别下工作
    RR级别会启用间隙锁
Q6: purge线程？
Q7: 一致性锁定读，一致性非锁定读？
Q8: information_schema表 
    innodb_tx
    innodb_locks
    innodb_lock_waits

## 大事务
定义：运行时间比较长，操作的数据比较多的事务

风险：1. 锁定太多的数据，造成大量的阻塞和锁超,2. 回滚时所需时间较长3. 执行时间长，容易造成主从延迟

如何处理大事务
1. 避免一次处理太多的数据
2. 移除不必要的在事物中的逻辑，如select查询

大事务化小事务：
    可做到快速释放锁，避免了其他客户端的锁等待超时
    


## 幂等操作
* insert : 唯一键
* update : 版本控制 
* 引入log表
## mybatis
* 默认情况下，mybatis 的 update 操作返回值是记录的 matched 的条数，并不是影响的记录条数。
* [修改mybatis-update结果为受影响行数](https://notes.wanghao.work/2017-09-06-%E8%81%8A%E8%81%8AMybatis-Update%E6%93%8D%E4%BD%9C%E8%BF%94%E5%9B%9E%E5%80%BC.html)
## Exception异常处理
## java 动态代理
* Q1: mapper insert唯一键冲突，不抛出真实异常，抛出了undeclaredThrowableException.
* 

## sql binlog
	
## GeoHash
将精度和维度转换成字符串。
base32编码，解码

[附近地址搜索](https://charlee.li/geohash-intro.html)

## ELK
(elk协议)[https://www.ibm.com/developerworks/cn/opensource/os-cn-elk/index.html]

## sql

## 全链路压测
[淘宝-全链路压测](http://www.yopai.com/show-2-113932-1.html)

* 容量规划归根结底就是：在什么时候什么样的系统需要多少服务器？需要给出有确定性，量化的数字。

[阿里云栖-压测](https://www.jianshu.com/p/e060be4cf266)
[滴滴全链路压测](http://www.tiejiang.org/19811.html)
[支付宝性能压测](http://www.infoq.com/cn/articles/performance-test-of-zhifubao)
[性能优化常见招式](http://www.58maisui.com/2016/06/18/a-232/)
[性能调优策略](https://coolshell.cn/articles/7490.html)

[美团点评-性能调优](https://tech.meituan.com/performance_tunning.html)

[美团点评-慢sql调优](https://tech.meituan.com/mysql-index.html)

[QPS和TPS影响因素](http://www.10tiao.com/html/439/201512/423511225/1.html)

## 性能测试瓶颈分析
* 先看业务指标：响应时间（最小，最大，平均，95line,99line）、业务错误率，tps是否满足需求
* 网络、db的性能、连接数

## 系统性能
* uptime : 查看load-average
* [性能测试体系知识分享](http://www.cnblogs.com/springfly206/p/6179239.html)


## code review 关注点

## R语言-画图
[w3教程](https://www.w3cschool.cn/r/r_line_graphs.html)
[R manuals](https://cran.r-project.org/manuals.html)

``` R
示例：画折线图(x轴，多y轴)
v <- c(7,12,28,3,41)
t <- c(14,7,6,19,3)
plot(v,type = "o",col = "red", xlab = "Month", ylab = "Rain fall", main = "Rain fall chart")
lines(t, type = "o", col = "blue")
```

## 其他


之前参考阿里的编码规约，其中提到：
【强制】在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。 
说明：1 ） 增加查询分析器解析成本。2 ） 增减字段容易与 resultMap 配置不一致。

  测试了下，增减字段后代码并不会报错。数据库新增字段时，select * 完成后再与resultMap中的字段进行匹配。数据库删除字段后，resultMap中多的字段的值会变成null.